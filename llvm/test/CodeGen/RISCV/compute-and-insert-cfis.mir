# RUN: llc %s -mtriple=riscv64 -run-pass=compute-and-insert-cfis \
# RUN:   -riscv-emit-cfi-after-fe=true -o - | FileCheck %s

---
name:            track_cfa_add_same_reg
tracksRegLiveness: true
body:             |
  bb.0.entry:
    $x2 =  ADDI $x2, -16
    $x2 =  ADDI $x2, 16
    PseudoRET
...

---
name:            track_cfa_copy
tracksRegLiveness: true
body:             |
  bb.0.entry:
    $x10 =  ADDI $x2, 0
    $x2 =  ADDI $x10, 0
    PseudoRET

...

---
name:            track_cfa_add_different_reg
tracksRegLiveness: true
body:             |
  bb.0.entry:
    $x3 =  ADDI $x2, -16
    $x2 =  ADDI $x3, 16
    PseudoRET

...

---
name:            track_cfa_multiple_addi_same_reg
tracksRegLiveness: true
body:             |
  bb.0.entry:
    $x2 =  ADDI $x2, -16
    $x2 =  ADDI $x2, 8
    $x2 =  ADDI $x2, -32
    $x2 =  ADDI $x2, 40
    PseudoRET

...

---
name:            track_cfa_multiple_copies
tracksRegLiveness: true
body:             |
  bb.0.entry:
    $x3 =  ADDI $x2, 0
    $x4 =  ADDI $x3, 0
    $x5 =  ADDI $x4, 0
    $x2 =  ADDI $x5, 0
    PseudoRET

...

---
name:            track_cfa_multiple_addi_different_reg
tracksRegLiveness: true
body:             |
  bb.0.entry:
    $x3 =  ADDI $x2, 8
    $x4 =  ADDI $x3, -16
    $x5 =  ADDI $x4, 24
    $x2 =  ADDI $x5, -16
    PseudoRET

...

---
name:            track_cfa_diamond_cfg
tracksRegLiveness: true
body:             |
  bb.0.entry:
    liveins: $x10
    BEQ $x10, $x0, %bb.2
  
  bb.1:
    $x2 = ADDI $x2, -16
    $x2 = ADDI $x2, 16
    PseudoBR %bb.3
  
  bb.2:
    PseudoBR %bb.3
  
  bb.3:
    PseudoRET

...
#---
#name:            track_cfa_loop
#tracksRegLiveness: true
#body:             |
#  bb.0.entry:
#    liveins: $x1, $x8, $x9, $x10
#    
#    $x2 =  ADDI $x2, -64
#     SD killed $x1, $x2, 56
#     SD killed $x8, $x2, 48
#     SD killed $x9, $x2, 40
#    $x8 =  ADDI $x2, 64
#    $x9 = ADDI $x0, 10
#    PseudoBR %bb.1
#  
#  bb.1:
#    liveins: $x8, $x9, $x10
#    
#    $x2 = ADDI $x8, -64
#    $x2 = ADDI $x2, -16
#    PseudoCALL target-flags(riscv-call) @external_func, csr_ilp32_lp64, implicit-def dead $x1, implicit $x2, implicit-def $x2
#    $x2 = ADDI $x8, -64
#    $x9 = ADDI $x9, -1
#    BNE $x9, $x0, %bb.1
#  
#  bb.2:
#    liveins: $x8
#    
#    $x2 = ADDI $x8, -64
#    $x9 =  LD $x2, 40
#    $x8 =  LD $x2, 48
#    $x1 =  LD $x2, 56
#    $x2 =  ADDI $x2, 64
#    PseudoRET
#
#...
#---
#name:            track_cfa_nested_branches
#tracksRegLiveness: true
#body:             |
#  bb.0.entry:
#    liveins: $x1, $x8, $x9, $x10, $x11
#    
#    $x2 =  ADDI $x2, -80
#     SD killed $x1, $x2, 72
#     SD killed $x8, $x2, 64
#     SD killed $x9, $x2, 56
#    $x8 =  COPY $x2
#    BEQ $x10, $x0, %bb.3
#  
#  bb.1:
#    liveins: $x8, $x11
#    
#    $x2 = COPY $x8
#    $x2 = ADDI $x2, -16
#    BEQ $x11, $x0, %bb.4
#  
#  bb.2:
#    liveins: $x8
#    
#    $x9 = COPY $x8
#    $x2 = ADDI $x9, -32
#    PseudoBR %bb.5
#  
#  bb.3:
#    liveins: $x8
#    
#    $x2 = ADDI $x8, -48
#    PseudoBR %bb.5
#  
#  bb.4:
#    liveins: $x8
#    
#    $x2 = COPY $x8
#    $x2 = ADDI $x2, -24
#    PseudoBR %bb.5
#  
#  bb.5:
#    liveins: $x8
#    
#    $x2 = COPY $x8
#    $x9 =  LD $x2, 56
#    $x8 =  LD $x2, 64
#    $x1 =  LD $x2, 72
#    $x2 =  ADDI $x2, 80
#    PseudoRET
#
#...
#---
#name:            track_cfa_multiple_returns
#tracksRegLiveness: true
#body:             |
#  bb.0.entry:
#    liveins: $x1, $x8, $x10
#    
#    $x2 =  ADDI $x2, -32
#     SD killed $x1, $x2, 24
#     SD killed $x8, $x2, 16
#    $x8 =  ADDI $x2, 32
#    BEQ $x10, $x0, %bb.2
#  
#  bb.1:
#    liveins: $x8
#    
#    $x2 = ADDI $x8, -32
#    $x2 = ADDI $x2, -16
#    PseudoCALL target-flags(riscv-call) @external_func, csr_ilp32_lp64, implicit-def dead $x1, implicit $x2, implicit-def $x2
#    $x2 = ADDI $x8, -32
#    $x8 =  LD $x2, 16
#    $x1 =  LD $x2, 24
#    $x2 =  ADDI $x2, 32
#    PseudoRET
#  
#  bb.2:
#    liveins: $x8
#    
#    $x2 = COPY $x8
#    $x2 = ADDI $x2, -32
#    $x8 =  LD $x2, 16
#    $x1 =  LD $x2, 24
#    $x2 =  ADDI $x2, 32
#    PseudoRET
#
#...
#---
#name:            track_cfa_switch_like
#tracksRegLiveness: true
#body:             |
#  bb.0.entry:
#    liveins: $x1, $x8, $x9, $x10
#    
#    $x2 =  ADDI $x2, -64
#     SD killed $x1, $x2, 56
#     SD killed $x8, $x2, 48
#     SD killed $x9, $x2, 40
#    $x8 =  COPY $x2
#    $x11 = ADDI $x0, 1
#    BEQ $x10, $x11, %bb.2
#  
#  bb.1:
#    liveins: $x8, $x10
#    
#    $x11 = ADDI $x0, 2
#    BEQ $x10, $x11, %bb.3
#    PseudoBR %bb.4
#  
#  bb.2:
#    liveins: $x8
#    
#    $x2 = COPY $x8
#    $x2 = ADDI $x2, -16
#    PseudoBR %bb.5
#  
#  bb.3:
#    liveins: $x8
#    
#    $x9 = COPY $x8
#    $x2 = ADDI $x9, -32
#    PseudoBR %bb.5
#  
#  bb.4:
#    liveins: $x8
#    
#    $x2 = ADDI $x8, -48
#    PseudoBR %bb.5
#  
#  bb.5:
#    liveins: $x8
#    
#    $x2 = COPY $x8
#    $x9 =  LD $x2, 40
#    $x8 =  LD $x2, 48
#    $x1 =  LD $x2, 56
#    $x2 =  ADDI $x2, 64
#    PseudoRET
#
#...
#---
#name:            track_cfa_complex_loop_with_branches
#tracksRegLiveness: true
#body:             |
#  bb.0.entry:
#    liveins: $x1, $x8, $x9, $x10, $x11
#    
#    $x2 =  ADDI $x2, -96
#     SD killed $x1, $x2, 88
#     SD killed $x8, $x2, 80
#     SD killed $x9, $x2, 72
#    $x8 =  ADDI $x2, 96
#    $x9 = ADDI $x0, 5
#    PseudoBR %bb.1
#  
#  bb.1:
#    liveins: $x8, $x9, $x10, $x11
#    
#    $x2 = ADDI $x8, -96
#    BEQ $x10, $x0, %bb.3
#  
#  bb.2:
#    liveins: $x8, $x9, $x11
#    
#    $x2 = COPY $x8
#    $x2 = ADDI $x2, -96
#    $x2 = ADDI $x2, -16
#    BEQ $x11, $x0, %bb.4
#    PseudoBR %bb.5
#  
#  bb.3:
#    liveins: $x8, $x9
#    
#    $x2 = ADDI $x8, -96
#    $x2 = ADDI $x2, -32
#    PseudoBR %bb.5
#  
#  bb.4:
#    liveins: $x8, $x9
#    
#    $x2 = ADDI $x8, -96
#    $x2 = ADDI $x2, -48
#    PseudoBR %bb.5
#  
#  bb.5:
#    liveins: $x8, $x9
#    
#    $x2 = ADDI $x8, -96
#    PseudoCALL target-flags(riscv-call) @external_func, csr_ilp32_lp64, implicit-def dead $x1, implicit $x2, implicit-def $x2
#    $x9 = ADDI $x9, -1
#    BNE $x9, $x0, %bb.1
#  
#  bb.6:
#    liveins: $x8
#    
#    $x2 = ADDI $x8, -96
#    $x9 =  LD $x2, 72
#    $x8 =  LD $x2, 80
#    $x1 =  LD $x2, 88
#    $x2 =  ADDI $x2, 96
#    PseudoRET
#
#...
#---
#name:            track_cfa_early_exit_paths
#tracksRegLiveness: true
#body:             |
#  bb.0.entry:
#    liveins: $x1, $x8, $x9, $x10, $x11
#    
#    $x2 =  ADDI $x2, -48
#     SD killed $x1, $x2, 40
#     SD killed $x8, $x2, 32
#     SD killed $x9, $x2, 24
#    $x8 =  COPY $x2
#    BEQ $x10, $x0, %bb.5
#  
#  bb.1:
#    liveins: $x8, $x11
#    
#    $x2 = COPY $x8
#    $x2 = ADDI $x2, -16
#    BEQ $x11, $x0, %bb.5
#  
#  bb.2:
#    liveins: $x8
#    
#    $x9 = COPY $x8
#    $x2 = ADDI $x9, -32
#    PseudoCALL target-flags(riscv-call) @external_func, csr_ilp32_lp64, implicit-def dead $x1, implicit $x2, implicit-def $x2
#    $x2 = COPY $x8
#    $x2 = ADDI $x2, -16
#    BEQ $x10, $x0, %bb.4
#  
#  bb.3:
#    liveins: $x8
#    
#    $x2 = ADDI $x8, -48
#    PseudoBR %bb.5
#  
#  bb.4:
#    liveins: $x8
#    
#    $x2 = COPY $x8
#    PseudoBR %bb.5
#  
#  bb.5:
#    liveins: $x8
#    
#    $x2 = COPY $x8
#    $x9 =  LD $x2, 24
#    $x8 =  LD $x2, 32
#    $x1 =  LD $x2, 40
#    $x2 =  ADDI $x2, 48
#    PseudoRET
#
#...
#---
#name:            track_cfa_irreducible_cfg
#tracksRegLiveness: true
#body:             |
#  bb.0.entry:
#    liveins: $x1, $x8, $x9, $x10, $x11
#    
#    $x2 =  ADDI $x2, -64
#     SD killed $x1, $x2, 56
#     SD killed $x8, $x2, 48
#     SD killed $x9, $x2, 40
#    $x8 =  ADDI $x2, 64
#    BEQ $x10, $x0, %bb.2
#  
#  bb.1:
#    liveins: $x8, $x11
#    
#    $x2 = ADDI $x8, -64
#    $x2 = ADDI $x2, -16
#    BEQ $x11, $x0, %bb.3
#    PseudoBR %bb.2
#  
#  bb.2:
#    liveins: $x8, $x11
#    
#    $x9 = COPY $x8
#    $x2 = ADDI $x9, -64
#    $x2 = ADDI $x2, -32
#    BNE $x11, $x0, %bb.1
#  
#  bb.3:
#    liveins: $x8
#    
#    $x2 = ADDI $x8, -64
#    $x9 =  LD $x2, 40
#    $x8 =  LD $x2, 48
#    $x1 =  LD $x2, 56
#    $x2 =  ADDI $x2, 64
#    PseudoRET
#
#...
#---
#name:            track_cfa_deep_nesting
#tracksRegLiveness: true
#body:             |
#  bb.0.entry:
#    liveins: $x1, $x8, $x9, $x10, $x11, $x12
#    
#    $x2 =  ADDI $x2, -112
#     SD killed $x1, $x2, 104
#     SD killed $x8, $x2, 96
#     SD killed $x9, $x2, 88
#    $x8 =  COPY $x2
#    BEQ $x10, $x0, %bb.8
#  
#  bb.1:
#    liveins: $x8, $x11, $x12
#    
#    $x2 = COPY $x8
#    $x2 = ADDI $x2, -16
#    BEQ $x11, $x0, %bb.7
#  
#  bb.2:
#    liveins: $x8, $x12
#    
#    $x9 = COPY $x8
#    $x2 = ADDI $x9, -32
#    BEQ $x12, $x0, %bb.6
#  
#  bb.3:
#    liveins: $x8
#    
#    $x2 = ADDI $x8, -48
#    $x2 = ADDI $x2, -16
#    PseudoBR %bb.4
#  
#  bb.4:
#    liveins: $x8
#    
#    $x2 = COPY $x8
#    $x2 = ADDI $x2, -64
#    PseudoBR %bb.5
#  
#  bb.5:
#    liveins: $x8
#    
#    $x2 = ADDI $x8, -80
#    PseudoBR %bb.9
#  
#  bb.6:
#    liveins: $x8
#    
#    $x2 = COPY $x8
#    $x2 = ADDI $x2, -96
#    PseudoBR %bb.9
#  
#  bb.7:
#    liveins: $x8
#    
#    $x2 = ADDI $x8, -48
#    PseudoBR %bb.9
#  
#  bb.8:
#    liveins: $x8
#    
#    $x2 = COPY $x8
#    PseudoBR %bb.9
#  
#  bb.9:
#    liveins: $x8
#    
#    $x2 = COPY $x8
#    $x9 =  LD $x2, 88
#    $x8 =  LD $x2, 96
#    $x1 =  LD $x2, 104
#    $x2 =  ADDI $x2, 112
#    PseudoRET
#
#...
#---
#name:            track_cfa_convergent_paths
#tracksRegLiveness: true
#body:             |
#  bb.0.entry:
#    liveins: $x1, $x8, $x9, $x10, $x11, $x12, $x13
#    
#    $x2 =  ADDI $x2, -80
#     SD killed $x1, $x2, 72
#     SD killed $x8, $x2, 64
#     SD killed $x9, $x2, 56
#    $x8 =  ADDI $x2, 80
#    BEQ $x10, $x0, %bb.2
#  
#  bb.1:
#    liveins: $x8, $x11
#    
#    $x2 = ADDI $x8, -80
#    $x2 = ADDI $x2, -16
#    BEQ $x11, $x0, %bb.4
#    PseudoBR %bb.3
#  
#  bb.2:
#    liveins: $x8, $x12
#    
#    $x9 = COPY $x8
#    $x2 = ADDI $x9, -80
#    $x2 = ADDI $x2, -16
#    BEQ $x12, $x0, %bb.4
#  
#  bb.3:
#    liveins: $x8, $x13
#    
#    $x2 = COPY $x8
#    $x2 = ADDI $x2, -80
#    $x2 = ADDI $x2, -32
#    BEQ $x13, $x0, %bb.5
#    PseudoBR %bb.6
#  
#  bb.4:
#    liveins: $x8
#    
#    $x2 = ADDI $x8, -80
#    $x2 = ADDI $x2, -48
#    PseudoBR %bb.6
#  
#  bb.5:
#    liveins: $x8
#    
#    $x2 = COPY $x8
#    $x2 = ADDI $x2, -80
#    PseudoBR %bb.6
#  
#  bb.6:
#    liveins: $x8
#    
#    $x2 = ADDI $x8, -80
#    $x9 =  LD $x2, 56
#    $x8 =  LD $x2, 64
#    $x1 =  LD $x2, 72
#    $x2 =  ADDI $x2, 80
#    PseudoRET
#
#...
